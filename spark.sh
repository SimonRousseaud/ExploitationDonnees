#!/bin/bash

 cd

# Update package manager
sudo apt-get update -y
echo "APT-GET OK "

# Install Java
sudo apt-get install openjdk-11-jdk -y
echo "APT-GET OK "

# Install Spark

wget -P ~ https://downloads.apache.org/spark/spark-3.1.1/spark-3.1.1-bin-hadoop3.2.tgz
echo "WGET OK "

cd ~ && tar xvf spark-3.1.1-bin-hadoop3.2.tgz
echo "TAR OK "
sudo mv spark-3.1.1-bin-hadoop3.2 /usr/local/spark
echo "MV OK"
# Set environment variables
echo "export SPARK_HOME=/usr/local/spark" >> ~/.bashrc
echo "export PATH=$PATH:$SPARK_HOME/bin" >> ~/.bashrc
source ~/.bashrc

echo "BASHRC OK "

git clone git@github.com:SimonRousseaud/ExploitationDonnees.git ExploitationDonnees
echo "GIT CLONED OK "
# Deploy your application
cd ExploitationDonnees
mvn install
echo "MVN Install OK "

cp /target/Projet-javaaaaa3-1.0-SNAPSHOT.jar /usr/local/spark/Projet-javaaaaa3-1.0-SNAPSHOT.jar

ip4=$(/sbin/ip -o -4 addr list eth0 | awk '{print $4}' | cut -d/ -f1)

start-worker.sh spark://$ip4:7077

# Execute the application
spark-submit --class org.example.main --master local[*] /usr/local/spark/Projet-javaaaaa3-1.0-SNAPSHOT.jar