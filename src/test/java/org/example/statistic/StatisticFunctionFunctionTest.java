package org.example.statistic;

import org.apache.spark.sql.Dataset;
import org.apache.spark.sql.SparkSession;
import org.example.function.parser.beans.IPS;
import org.example.function.parser.beans.StatisticFunction;
import org.junit.Test;
import org.apache.spark.sql.Encoders;

import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;

public class StatisticFunctionFunctionTest {

    @Test
    public void testStatistic() {

        SparkSession sparkSession = SparkSession.builder().master("local[2]").getOrCreate();

        StatisticFunction f = new StatisticFunction();

        Dataset<IPS> ips = sparkSession.createDataset(
                List.of(new IPS("2021-2022", "CRETEIL", "93", "SEINE-SAINT-DENIS", "0931318C", "ECOLE ELEMENTAIRE HONORE DE BALZAC", "93073", "TREMBLAY EN FRANCE", "public", "103.1")),
                Encoders.bean(IPS.class)
        );

        Long expected = 2226L;
        Long actual = f.apply(ips);

        assertThat(actual).isEqualTo(expected);

    }
}
